<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.5//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.secondhandauctions.dao.BidDao">

    <!--  입찰  -->
    <!--  isProductCheck = 1 인것만 입찰  -->
<!--    <insert id="registerBid" parameterType="Map">-->
<!--        insert into bid-->
<!--        (-->
<!--         productId, bidMemberId, bidPrice-->
<!--        )-->
<!--        values-->
<!--        (-->
<!--         #{productId}, #{bidMemberId}, #{bidPrice}-->
<!--        )-->
<!--    </insert>-->

    <insert id="registerBid" parameterType="Map">
        insert into bid
        (
         productId, bidMemberId, bidPrice
        )
         select #{productId}, #{bidMemberId}, #{bidPrice} from dual where exists
        (
         select isProductCheck from product where productId = #{productId} and isProductCheck = 1;
        )
    </insert>

    <!--  최상위 입찰자  -->
    <select id="topBidMember" parameterType="int" resultType="String">
        select bidMemberId from bid where productId = #{productId} and bidPrice = (select max(bidPrice) from bid);
    </select>
</mapper>